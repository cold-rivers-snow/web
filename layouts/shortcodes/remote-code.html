{{/* Remote Code Shortcode - 使用Hextra主题样式显示远程代码内容 */}}
{{- $url := .Get "url" -}}
{{- $lang := .Get "lang" | default "text" -}}
{{- $title := .Get "title" | default "" -}}
{{- $lines := .Get "lines" | default "" -}}

{{- if not $url -}}
  <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
    <p class="text-red-800 font-semibold">❌ 错误：缺少 URL 参数</p>
  </div>
{{- else -}}
  <div class="remote-code-container hx:mt-6 hx:first:mt-0" data-url="{{ $url }}" data-lang="{{ $lang }}" data-title="{{ $title }}" data-lines="{{ $lines }}">
    
    {{- if $title -}}
      <div class="bg-gray-100 dark:bg-gray-800 px-4 py-2 rounded-t-lg border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100">{{ $title }}</h4>
          <a href="{{ $url }}" target="_blank" rel="noopener noreferrer" 
             class="text-xs text-blue-600 dark:text-blue-400 hover:underline">
            查看源文件 ↗
          </a>
        </div>
      </div>
    {{- end -}}
    
    <!-- 加载状态 -->
    <div class="loading-state bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
      <div class="flex items-center justify-center space-x-2 text-blue-800 mb-2">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-800"></div>
        <span class="text-sm">正在加载代码...</span>
      </div>
      <p class="text-blue-600 text-xs break-all">{{ $url }}</p>
    </div>
    
    <!-- 错误状态 -->
    <div class="error-state bg-red-50 border border-red-200 rounded-lg p-4 hidden">
      <h3 class="text-red-800 font-semibold text-sm mb-2">❌ 加载失败</h3>
      <p class="error-message text-red-600 text-sm mb-2"></p>
      <p class="text-red-600 text-xs">请检查网络连接或URL是否正确</p>
    </div>
    
    <!-- 代码显示区域 - 使用Hextra主题样式 -->
    <div class="code-display hidden">
      <div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code">
        <!-- 折叠控制按钮 - 调整位置避免遮挡代码 -->
        <div class="code-collapse-container hidden hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-12 hx:top-0 hx:z-10">
          <button class="code-collapse-btn hx:group/collapsebtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50" title="展开代码">
            <!-- 展开图标 - 使用文字 -->
            <span class="expand-icon text-xs font-bold">展开</span>
            <!-- 折叠图标 - 使用文字 -->
            <span class="collapse-icon text-xs font-bold hidden">折叠</span>
          </button>
        </div>
        
        <div class="code-content-wrapper">
          <!-- 添加顶部padding避免按钮遮挡 -->
          <div class="code-top-spacer" style="height: 45px; position: absolute; top: 0; left: 0; right: 0; z-index: 5; pointer-events: none;"></div>
          <div class="highlight">
            <pre tabindex="0" class="chroma" style="padding-top: 45px;">
              <code class="code-content" data-lang="{{ $lang }}"></code>
            </pre>
          </div>
        </div>
      </div>
      
      {{- if not $title -}}
        <div class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-right">
          <a href="{{ $url }}" target="_blank" rel="noopener noreferrer" 
             class="hover:text-blue-600 dark:hover:text-blue-400">
            查看源文件 ↗
          </a>
        </div>
      {{- end -}}
    </div>
  </div>
{{- end -}}

