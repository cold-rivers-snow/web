---
title: "基础语法3"
weight: 3
---

## stl

### array

```cpp
#include <format>
#include <iostream>
#include <array>

int main() {
   std::array<int, 5> values; // 初始化 5 大小的数组

   for (size_t i{0}; i < values.size(); ++i) {// size_t 无符号整数类型
      values[i] = 0; // 赋值为0
   }

   std::cout << std::format("{:>7}{:>10}\n", "Element", "Value");

   for (size_t i{0}; i < values.size(); ++i) {
      std::cout << std::format("{:>7}{:>10}\n", i, values[i]);//[] 取值
   }

   std::cout << std::format("\n{:>7}{:>10}\n", "Element", "Value");

   for (size_t i{0}; i < values.size(); ++i) {
      std::cout << std::format("{:>7}{:>10}\n", i, values.at(i));//at 取值
   }

   values.at(10); // 超过数组大小，异常

   std::array<int, 5> values{32, 27, 64, 18, 95}; // 初始化为 int 类型

   for (size_t i{0}; i < values.size(); ++i) {
      std::cout << std::format("{}  ", values.at(i));// at 取值，{} 占位符
   }

   std::cout << "\n\n";

   std::array values2{1.1, 2.2, 3.3, 4.4}; // 根据初始化值类型自动推导为 double 类型，大小为4，与 std::array<double, 4> value2{1.1, 2.2, 3.3, 4.4} 相同

   for (size_t i{0}; i < values2.size(); ++i) {
      std::cout << std::format("{}  ", values2.at(i));
   }

   std::cout << '\n';
}
```

for 遍历

```cpp
#include <format>
#include <iostream>
#include <array>

int main() {
   std::array items{1, 2, 3, 4, 5}; // 同 array<int, 5>

   std::cout << "items before modification: ";
   for (const int& item : items) { // const reference
      std::cout << std::format("{} ", item); 
   }                       
 
   for (int& item : items) { // reference
      item *= 2;  //修改 item 的值
   }

   std::cout << "\nitems after modification: ";
   for (const int& item : items) {
      std::cout << std::format("{} ", item);
   }

   std::cout << "\n\ncalculating a running total of items' values:\n";
   for (int runningTotal{0}; const int& item : items) {
      runningTotal += item;
      std::cout << std::format("item: {}; running total: {}\n",
         item, runningTotal);
   }
}
```

```cpp
#include <format>
#include <iostream>
#include <array>

int main() {
   constexpr size_t arraySize{5}; // 常量表达式，constexpr 在编译时处理，必须初始化

   std::array<int, arraySize> values{};

   for (int i{0}; i < values.size(); ++i) { //遍历赋值。
      values.at(i) = 2 + 2 * i;
   }

   for (const int& value : values) {
      std::cout << std::format("{}  ", value);
   }

   std::cout << '\n';
}
```

```cpp
#include <array>
#include <algorithm> // contains sort and binary_search
#include <format>
#include <iostream>
#include <string>

int main() {
   using namespace std::string_literals; // std::string_literals 是 C++14 标准库中的一个内联命名空间，核心作用是：为字符串字面量提供 s 后缀，让双引号包裹的字符串直接生成 std::string 对象，而非传统的 const char* 字符数组

   // array<string, 7>， 这里自动推导，可以推导成 string 类型，而不是指针
   std::array colors{"red"s, "orange"s, "yellow"s,
      "green"s, "blue"s, "indigo"s, "violet"s}; // C 风格字符串， 字符串对象字面量

   std::cout << "Unsorted colors array:\n   ";
   for (const std::string& color : colors) {
      std::cout << std::format("{} ", color);
   }

   // 排序
   std::sort(std::begin(colors), std::end(colors));

   std::cout << "\nSorted colors array:\n   ";
   for (const std::string& color : colors) {
      std::cout << std::format("{} ", color);
   }

   // 二分查找 indigo
   bool found{std::binary_search(
      std::begin(colors), std::end(colors), "indigo")};
   std::cout << std::format("\n\n\"indigo\" {} found in colors array\n",
      found ? "was" : "was not");

   // 二分查找 "cyan"
   found = std::binary_search(
      std::begin(colors), std::end(colors), "cyan");
   std::cout << std::format("\"cyan\" {} found in colors array\n",
      found ? "was" : "was not");
}
```

二维数组

```cpp
#include <iostream> 
#include <array> 

constexpr size_t rows{2};
constexpr size_t columns{3};
void printArray(const std::array<std::array<int, columns>, rows>& a);

int main() {
   constexpr std::array values1{std::array{1, 2, 3}, std::array{4, 5, 6}}; // 自动推导
   constexpr std::array values2{std::array{1, 2, 3}, std::array{4, 5, 0}};

   std::cout << "values1 by row:\n";
   printArray(values1);

   std::cout << "\nvalues2 by row:\n";
   printArray(values2);
}

void printArray(const std::array<std::array<int, columns>, rows>& a) {
   for (const auto& row : a) {
      for (const auto& element : row) {
         std::cout << element << ' ';
      }

      std::cout << '\n'; // start new line of output             
   }
}
```

### vector

- at 函数获取值会做异常检查，[]获取可能出现异常错误。
- 可动态扩容，确定个数，指定个数性能会更好。


```cpp
#include <iostream>
#include <vector>    
#include <stdexcept> 

void outputVector(const std::vector<int>& items);
void inputVector(std::vector<int>& items);

int main() {
   std::vector<int> integers1(7); //7个元素个数，默认值为0
   std::vector<int> integers2(10); // 10个元素个数，默认值为0

   std::cout << "Size of vector integers1 is " << integers1.size()
      << "\nvector after initialization: ";
   outputVector(integers1);

   std::cout << "\nSize of vector integers2 is " << integers2.size()
      << "\nvector after initialization: ";
   outputVector(integers2);

   std::cout << "\nEnter 17 integers:\n";
   inputVector(integers1);
   inputVector(integers2);

   std::cout << "\nAfter input, the vectors contain:\n"
      << "integers1: ";
   outputVector(integers1);
   std::cout << "integers2: ";
   outputVector(integers2);

   std::cout << "\nEvaluating: integers1 != integers2\n";

   if (integers1 != integers2) {
      std::cout << "integers1 and integers2 are not equal\n";
   }
        
   std::vector integers3{integers1};//拷贝构造

   std::cout << "\nSize of vector integers3 is " << integers3.size()
      << "\nvector after initialization: ";
   outputVector(integers3);
         
   std::cout << "\nAssigning integers2 to integers1:\n";
   integers1 = integers2; //使用赋值重载运算符

   std::cout << "integers1: ";
   outputVector(integers1);
   std::cout << "integers2: ";
   outputVector(integers2);

   std::cout << "\nEvaluating: integers1 == integers2\n";

   if (integers1 == integers2) { //使用比较运算符 ==
      std::cout << "integers1 and integers2 are equal\n";
   }

   std::cout << "\nintegers1.at(5) is " << integers1.at(5);

   std::cout << "\n\nAssigning 1000 to integers1.at(5)\n";
   integers1.at(5) = 1000; //可以使用赋值操作给 at的索引值
   std::cout << "integers1: ";
   outputVector(integers1);
                  
   try {
      std::cout << "\nAttempt to display integers1.at(15)\n";
      std::cout << integers1.at(15) << '\n';
   } catch (const std::out_of_range& ex) {
      std::cerr << "An exception occurred: " << ex.what() << '\n';
   }

   std::cout << "\nCurrent integers3 size is: " << integers3.size(); //vector 的长度。
   integers3.push_back(1000); // 尾部追加值 1000
   std::cout << "\nNew integers3 size is: " << integers3.size()
      << "\nintegers3 now contains: ";
   outputVector(integers3);
}

// for 遍历 vector 内容
void outputVector(const std::vector<int>& items) {
   for (const int& item : items) {
      std::cout << item << ' ';
   }

   std::cout << '\n';
}

// 终端输入数据
void inputVector(std::vector<int>& items) {
   for (int& item : items) {
      std::cin >> item;
   }
}
```

## 标准库函数

### accumulate

```cpp
#include <array>
#include <format>
#include <iostream>
#include <numeric> //数学相关函数的头文件

int main() {
   constexpr std::array integers{10, 20, 30, 40};
   std::cout << std::format("Total of array elements: {}\n",
      std::accumulate(std::begin(integers), std::end(integers), 0)); //数组中内容求和
}
```

### ranges 库相关函数

```cpp
#include <array>
#include <format>
#include <iostream>
#include <numeric>
#include <ranges>

int main() {
   auto showValues{
      [](auto& values, const std::string& message) {
         std::cout << std::format("{}: ", message);

         for (const auto& value : values) {
            std::cout << std::format("{} ", value);
         }

         std::cout << '\n';
      }
   }; //使用花括号定义一个匿名函数表达式的参数赋值。

   auto values1{std::views::iota(1, 11)}; // views::iota 随机生成整数 1-10，前闭后开
   showValues(values1, "Generate integers 1-10");

   // filter 过滤元素，只保留符合元素的，| 可以认为管道
   auto values2{values1 |
      std::views::filter([](const auto& x) {return x % 2 == 0;})};
   showValues(values2, "Filtering even integers");

   // transform 映射，不会改变元素数量
   auto values3{
      values2 | std::views::transform([](const auto& x) {return x * x;})};
   showValues(values3, "Mapping even integers to squares");

   // 组合前面几步，将 1-10 中的偶数求平方。
   auto values4{
      values1 | std::views::filter([](const auto& x) {return x % 2 == 0;})
              | std::views::transform([](const auto& x) {return x * x; })};
   showValues(values4, "Squares of even integers");

   // 求和
   std::cout << std::format("Sum squares of even integers 2-10: {}\n",
      std::accumulate(std::begin(values4), std::end(values4), 0));

   // 自定义的数组与 iota 随机生成的比较
   constexpr std::array numbers{1, 2, 3, 4, 5, 6, 7, 8, 9, 10};
   auto values5{
      numbers | std::views::filter([](const auto& x) {return x % 2 == 0;})
              | std::views::transform([](const auto& x) {return x * x;})};
   showValues(values5, "Squares of even integers in array numbers");
}
```
